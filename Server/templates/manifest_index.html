<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>APK Manifest Analyzer</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      padding: 20px;
      background: #f5f7fa;
      font-family: 'Segoe UI', sans-serif;
    }
    h1 {
      color: #1a73e8;
      margin-bottom: 20px;
    }
    .card {
      margin-bottom: 15px;
    }
    .badge {
      margin-right: 5px;
    }
    .permissions { background-color: #0d6efd; color: white; }
    .vulnerability { background-color: #dc3545; color: white; padding: 2px 6px; border-radius: 4px; display: inline-block; margin-bottom: 2px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üì¶ APK Manifest Analyzer</h1>


    <form method="post" enctype="multipart/form-data" class="mb-4">
      <div class="mb-3">
        <input type="file" name="apk_file" class="form-control" required>
      </div>
      <button type="submit" class="btn btn-primary">Analyze APK</button>
    </form>

    {% if report %}
      {% if report.error %}
        <div class="alert alert-danger">{{ report.error }}</div>
      {% else %}


        <div class="card">
          <div class="card-body">
            <h5>Permissions</h5>
            {% if report.permissions %}
              {% for p in report.permissions %}
                <span class="badge permissions">{{ p }}</span>
              {% endfor %}
            {% else %}
              <p>No permissions found</p>
            {% endif %}
          </div>
        </div>


        <div class="card">
          <div class="card-body">
            <h5>Vulnerabilities</h5>
            {% if report.vulnerabilities %}
              {% for v in report.vulnerabilities %}
                <span class="vulnerability">{{ v }}</span>
              {% endfor %}
            {% else %}
              <p>No obvious vulnerabilities detected</p>
            {% endif %}
          </div>
        </div>


        <div class="card">
          <div class="card-body">
            <h5>Risk Analysis</h5>
            {% if report.risk_score is defined %}
              <p><strong>Overall Risk Score:</strong> {{ report.risk_score }}/100</p>
              <p>üîπ Permission Risk: {{ report.permission_risk }}/60</p>
              <p>üî∏ Vulnerability Risk: {{ report.vulnerability_risk }}/40</p>

              {% if report.risk_score < 30 %}
                <span class="badge bg-success">Low Risk</span>
              {% elif report.risk_score < 70 %}
                <span class="badge bg-warning text-dark">Medium Risk</span>
              {% else %}
                <span class="badge bg-danger">High Risk</span>
              {% endif %}
            {% else %}
              <p>No risk analysis available.</p>
            {% endif %}
          </div>
        </div>


        <form method="post" action="/download_pdf">
          <input type="hidden" name="risk_score" value="{{ report.risk_score }}">
          <input type="hidden" name="permission_risk" value="{{ report.permission_risk }}">
          <input type="hidden" name="vulnerability_risk" value="{{ report.vulnerability_risk }}">
          <input type="hidden" name="permissions" value="{{ report.permissions|join(',') }}">
          <input type="hidden" name="vulnerabilities" value="{{ report.vulnerabilities|join(',') }}">
          <button type="submit" class="btn btn-success mt-3">‚¨áÔ∏è Download PDF Report</button>
        </form>

      {% endif %}
    {% endif %}
  </div>
</body>
</html>
